#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

quarkus.log.category."org.acme".level=DEBUG
quarkus.swagger-ui.always-include=true

quarkus.kogito.devservices.enabled=false

# Service we will call is in the module acme-financial-service generated by the OpenAPI Generator
# It's based on the openapi file in the specs dir
# acme_financial_service_yaml is the name of the openapi file used here as the key to configure the service connection
quarkus.rest-client.acme_financial_service_yaml.url=http://localhost:8181

quarkus.openapi-generator.codegen.spec.acme_financial_service_yml.base-package=com.acme
# We disabled the security codegen because it's not supporting token exchange at the moment
quarkus.openapi-generator.codegen.spec.acme_financial_service_yaml.enable-security-generation=false
# This is a custom register provider that does the token exchange based on our custom header X-Authentication-
quarkus.openapi-generator.codegen.spec.acme_financial_service_yaml.additional-api-type-annotations=@org.eclipse.microprofile.rest.client.annotation.RegisterProvider(org.acme.workflow.auth.WorkflowTokenRequestFilter.class)

# The token propagation from the OpenAPI Generator is also disabled since we don't have the generated security beans
//quarkus.openapi-generator.acme_financial_service_yaml.auth.acme_financial_oauth.token-propagation=true

# Information about this Keycloak instance can be found at ./scripts/boot-keycloak.sh and ./keycloak/realm-export.json
# acme_financial_oauth is the sanitized name of the SecurityScheme in the openapi spec file

quarkus.oidc-client.acme_financial_oauth.discovery-enabled=false
# Here's the openid discovery endpoint: http://localhost:9090/realms/acme/.well-known/openid-configuration
quarkus.oidc-client.acme_financial_oauth.auth-server-url=http://localhost:9090/realms/acme/protocol/openid-connect/auth
quarkus.oidc-client.acme_financial_oauth.token-path=http://localhost:9090/realms/acme/protocol/openid-connect/token
quarkus.oidc-client.acme_financial_oauth.client-id=workflow-app
quarkus.oidc-client.acme_financial_oauth.credentials.secret=secret
quarkus.oidc-client.acme_financial_oauth.grant.type=exchange
quarkus.oidc-client.acme_financial_oauth.credentials.client-secret.method=basic
quarkus.oidc-client.acme_financial_oauth.grant-options.exchange.subject_token_type=urn:ietf:params:oauth:token-type:access_token

quarkus.oidc-token-propagation.client-name=acme_financial_oauth
quarkus.oidc-token-propagation.exchange-token=true
quarkus.oidc-token-propagation.enabled=true

# Debug
quarkus.log.category."io.quarkus.oidc.client.runtime".level=TRACE
