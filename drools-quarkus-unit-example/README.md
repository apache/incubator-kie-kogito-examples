# Drools + Quarkus Hello World

## Installing and Running

- Prerequisites: install qs-playground 8.0-SNAPSHOT

- Compile and Run

    ```
     mvn clean compile quarkus:dev    
    ```

- Native Image (requires JAVA_HOME to point to a valid GraalVM)

    ```
    mvn package -Pnative
    ```
  
  native executable (and runnable jar) generated in `target/`

## OpenAPI (Swagger) documentation
[Specification at swagger.io](https://swagger.io/docs/specification/about/)

You can take a look at the [OpenAPI definition](http://localhost:8080/openapi?format=json) - automatically generated and included in this service - to determine all available operations exposed by this service. For easy readability you can visualize the OpenAPI definition file using a UI tool like for example available [Swagger UI](https://editor.swagger.io).

In addition, various clients to interact with this service can be easily generated using this OpenAPI definition.

When running in either Quarkus Development or Native mode, we also leverage the [Quarkus OpenAPI extension](https://quarkus.io/guides/openapi-swaggerui#use-swagger-ui-for-development) that exposes [Swagger UI](http://localhost:8080/swagger-ui/) that you can use to look at available REST endpoints and send test requests.

## Examples

### Hello World

Point to http://localhost:8080/hello for Drools hello world

### More complex example

- post 

```sh
curl -d '{"name":"edo", "age":32}' -H "Content-Type: application/json" \
    -X POST http://localhost:8080/persons                                                                                                    
```

- http://localhost:8080/persons/all returns a list of all persons

- http://localhost:8080/persons/adults returns a list of all adults

### Invoke autogenerated REST endpoints for queries

```sh
curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' -d '{"adultAge":18,"persons":[{"name":"Mario","age":45,"adult":false},{"name":"Marilena","age":47,"adult":false},{"name":"Sofia","age":7,"adult":false}]}' http://localhost:8080/find-adults
```
```sh
curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' -d '{"adultAge":18,"persons":[{"name":"Mario","age":45,"adult":false},{"name":"Marilena","age":47,"adult":false},{"name":"Sofia","age":7,"adult":false}]}' http://localhost:8080/find-adult-names
```
```sh
curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' -d '{"adultAge":18,"persons":[{"name":"Mario","age":45,"adult":false},{"name":"Marilena","age":47,"adult":false},{"name":"Sofia","age":7,"adult":false}]}' http://localhost:8080/find-not-adult-names-and-age
```

### Manual Deploy on Openshift

#### Build Container on docker
```sh
docker build -t quickstarter/quick-drools .
docker images | grep quick-drools
```

#### Deploy on Openshift
By default will be created under project called "My Project"
```sh
kubectl create -f kubernetes/deployment.yml 
kubectl create -f kubernetes/service.yml 
oc expose service quick-drools
```
this create a yaml file and the route for us on openshift, like this (in routes section on My Project)
 ```yaml
 
 apiVersion: route.openshift.io/v1
 kind: Route
 metadata:
   annotations:
     openshift.io/host.generated: 'true'
   creationTimestamp: '2019-02-20T10:25:59Z'
   labels:
     app: quick-drools
   name: quick-drools
   namespace: myproject
   resourceVersion: '30743'
   selfLink: /apis/route.openshift.io/v1/namespaces/myproject/routes/quick-drools
   uid: ea2676d6-34f9-11e9-bd97-08002709a920
 spec:
   host: quick-drools-myproject.192.168.99.109.nip.io
   port:
     targetPort: http
   to:
     kind: Service
     name: quick-drools
     weight: 100
   wildcardPolicy: None
 status:
   ingress:
     - conditions:
         - lastTransitionTime: '2019-02-20T10:25:59Z'
           status: 'True'
           type: Admitted
       host: quick-drools-myproject.192.168.99.109.nip.io
       routerName: router
       wildcardPolicy: None

 ```
 ```
 oc get route
 
  NAME           HOST/PORT                                      PATH      SERVICES       PORT      TERMINATION   WILDCARD
  quick-drools   quick-drools-myproject.192.168.99.109.nip.io             quick-drools   http                    None
  ```
  
  Your address will be
  http://quick-drools-myproject.192.168.99.109.nip.io/hello
